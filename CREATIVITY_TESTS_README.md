# 🧪 Глубокие тесты креативности ИИ для ролевой игры

## 📋 Обзор

Система тестирования проверяет способность ИИ создавать живые, атмосферные ролевые игры по 5 ключевым критериям:

1. **Понимание канона/сеттинга** (макс 9 баллов) - правильное использование деталей мира
2. **Живые NPC** (макс 9 баллов) - персонажи говорят, чувствуют, помнят, реагируют
3. **Атмосфера** (макс 9 баллов) - сенсорные детали, погружение
4. **Глубина эмоций** (макс 9 баллов) - сложные чувства без штампов
5. **NSFW качество** (макс 5 баллов) - естественность, без пошлости

**Итоговая оценка**: 0-10 баллов

## 🎯 4 теста

### Тест 1: Mo Dao Zu Shi (канон китайского фэнтези)
- **Цель**: Проверка понимания сложного канона (сянься, даньмэй)
- **Персонажи**: Вэй Усянь, Лань Ванцзи
- **Ключевые элементы**: культивация, 3000 правил клана Лань, скрытые чувства
- **Ожидается**: терминология сянься, передача характеров, атмосфера напряжённой встречи

### Тест 2: Сверхестественное (американский роудмуви + хоррор)
- **Цель**: Передача духа культового сериала
- **Персонажи**: Дин, Сэм, Кастиэль
- **Ключевые элементы**: охота, сарказм, Импала, семейные связи
- **Ожидается**: хоррор-атмосфера, иконические детали, живые диалоги

### Тест 3: Оригинальный мир (sci-fi с нуля)
- **Цель**: Способность создать уникальный мир
- **Персонажи**: Капитан Ария Ковальски
- **Ключевые элементы**: космическая станция, ИИ ЭРИДАН, моральная дилемма
- **Ожидается**: футуристическая атмосфера, напряжение, оригинальность

### Тест 4: Эмоциональная глубина + NSFW
- **Цель**: Сложные эмоции, романтика без пошлости
- **Персонажи**: Алекс, Дэниэл (бывшие любовники)
- **Ключевые элементы**: 5 лет разрыва, невысказанные чувства, случайная встреча
- **Ожидается**: противоречивые эмоции, напряжение, тонкая романтика

## 🚀 Запуск тестов

### Вариант 1: Python (рекомендуется)

```bash
python3 run_creativity_tests.py
```

**Результат**:
- Консольный вывод с прогрессом
- Файл `creativity-test-results.json` с полными данными

### Вариант 2: Node.js / Bun

```bash
node run-tests-locally.mjs
# или
bun run run-tests-locally.mjs
```

**Результат**:
- Консольный вывод
- Файл `test-results.json`

### Вариант 3: HTML (визуальный отчёт)

Откройте в браузере:
```bash
open creativity-tests-report.html
# или просто двойной клик по файлу
```

Нажмите кнопку "🚀 Запустить все тесты"

**Результат**:
- Красивый интерактивный отчёт
- Графики, метрики, цветовая индикация
- Фрагменты ответов ИИ

### Вариант 4: Backend функция (без локальной установки)

Прямой вызов API:
```bash
curl https://functions.poehali.dev/48bae726-ff9a-4027-9dc7-536b2e0f92f1
```

⚠️ **Внимание**: Выполнение занимает ~20-30 секунд (4 теста + паузы)

## 📊 Пример отчёта

```
================================================================================
📊 ДЕТАЛЬНЫЙ ОТЧЁТ ПО ВСЕМ ТЕСТАМ
================================================================================

📈 ОБЩАЯ СТАТИСТИКА:
   Всего тестов: 4
   Успешно: 4
   Провалено: 0
   Средняя оценка: 7.8/10
   Статус: 👍 ХОРОШО - небольшие улучшения

────────────────────────────────────────────────────────────────────────────────

🎯 ТЕСТ 1: Mo Dao Zu Shi (канон китайского фэнтези)
────────────────────────────────────────

⭐ ИТОГОВАЯ ОЦЕНКА: 8.2/10

📏 МЕТРИКИ:
   • Понимание канона/сеттинга: 7/9
   • Живые NPC: 8/9
   • Атмосфера: 7/9
   • Глубина эмоций: 8/9
   • NSFW качество: 3/5

✨ СИЛЬНЫЕ СТОРОНЫ:
   ✓ Использует терминологию сянься
   ✓ Сохраняет имена персонажей
   ✓ Передает характер Лань Ванцзи (строгость)
   ✓ NPC показывают внутренние переживания
   ✓ NPC используют язык тела (5 жестов)
   ✓ Достаточная длина (1247 символов)
   ✓ Нет штампованных фраз об эмоциях
   ✓ Использует молчание для передачи эмоций

⚠️ ПРОБЛЕМЫ:
   ⚠️ Слабо передан характер Вэй Усяня

💡 РЕКОМЕНДАЦИИ ДЛЯ УЛУЧШЕНИЯ:
   Усилить дерзость и иронию Вэй Усяня в диалогах

📝 КЛЮЧЕВЫЕ ФРАГМЕНТЫ:
   1. Лань Ванцзи стоял неподвижно, глядя на фигуру в белом...
   2. — Вэй Ин, — произнёс он, и в голосе не дрогнуло ни ноты...
   3. Между ними легла тишина тринадцати лет...

────────────────────────────────────────────────────────────────────────────────

🎯 ТЕСТ 2: Сверхестественное (американский роудмуви + хоррор)
...
```

## 🎯 Критерии оценки (детально)

### 1. Понимание канона/сеттинга (0-9 баллов)

**Для канонов (Mo Dao Zu Shi, Supernatural)**:
- ✓ Использует правильную терминологию (+3)
- ✓ Сохраняет имена и роли персонажей (+2)
- ✓ Передаёт характеры персонажей (+2-4)
- ✓ Использует иконические детали мира (+2)

**Для оригинального мира (Sci-Fi)**:
- ✓ Создаёт уникальные элементы сеттинга (+4)
- ✓ Передаёт атмосферу жанра (+3)
- ✓ Логичность и детализация мира (+2)

### 2. Живые NPC (0-9 баллов)

- ✓ Диалоги (5+ реплик = +3, 3-5 = +2, 1-2 = +1)
- ✓ Внутренние переживания (думает, вспоминает = +2)
- ✓ Язык тела (2+ жеста = +2, 1 = +1)
- ✓ Память о прошлом (+2)

**Штрафы**:
- ❌ Нет диалогов (-3)
- ❌ NPC как декорации (-2)

### 3. Атмосфера (0-9 баллов)

- ✓ Сенсорные детали: запахи, звуки, текстуры (4+ = +4, 2-3 = +2)
- ✓ Достаточная длина (800+ символов = +2)
- ✓ Эмоциональная насыщенность (3+ эмоций = +3)

**Штрафы**:
- ❌ Слишком короткий текст (<400 символов)

### 4. Глубина эмоций (0-9 баллов)

- ✓ Нет штампов ("сердце билось", "глаза загорелись") = +4
- ✓ Сложные/противоречивые эмоции (+3)
- ✓ Молчание/паузы для передачи чувств (+2)

**Штрафы**:
- ❌ Каждый штамп (-2)

### 5. NSFW качество (0-5 баллов)

- ✓ Романтика/страсть без вульгарности (+5)
- ✓ Нет NSFW элементов (начальная сцена) (+3)
- ⚠️ NSFW есть, но есть вульгарность (+2)
- ❌ Слишком вульгарно (3+ грубых слов = +1)

## 📈 Шкала оценок

| Балл | Статус | Описание |
|------|--------|----------|
| 9-10 | 🎉 ОТЛИЧНО | ИИ готов к продакшену, креативность на высоте |
| 7-8.9 | 👍 ХОРОШО | Качественный результат, небольшие улучшения |
| 5-6.9 | ⚠️ УДОВЛЕТВОРИТЕЛЬНО | Работает, но требуется доработка промпта |
| 3-4.9 | ❌ ПЛОХО | Серьёзные проблемы, нужна переработка |
| 0-2.9 | 💀 КРИТИЧНО | ИИ не справляется с задачей |

## 💡 Типичные проблемы и решения

### Проблема: "Слабое понимание канона"
**Решение**: 
```python
# В промпте добавить:
- Больше контекста о мире
- Ключевые цитаты персонажей
- Описание знаковых сцен
- Особенности жанра (терминология)
```

### Проблема: "NPC недостаточно живые"
**Решение**:
```python
# В промпте усилить:
- NPC ВСЕГДА реагируют на действия игрока
- У NPC есть память (помнят прошлые события)
- NPC используют язык тела (жесты, мимика)
- У NPC внутренние мысли (показывать их)
```

### Проблема: "Слабая атмосфера"
**Решение**:
```python
# Добавить в промпт:
- Детали: запахи, звуки, текстуры
- Визуальные описания (свет, тени)
- Эмоциональная насыщенность сцены
- Минимум 800 слов на ответ
```

### Проблема: "Эмоциональные штампы"
**Решение**:
```python
# В промпте указать:
- ИЗБЕГАТЬ: "сердце билось", "глаза загорелись"
- ПОКАЗЫВАТЬ эмоции через:
  * Действия (сжал кулаки, отвернулся)
  * Молчание и паузы
  * Противоречивое поведение
```

### Проблема: "Вульгарный NSFW"
**Решение**:
```python
# В промпте:
- NSFW должен быть ЧУВСТВЕННЫМ, не пошлым
- Фокус на эмоциях и атмосфере
- Избегать грубых слов
- Использовать метафоры и намёки
```

## 🔧 Настройка тестов

### Изменить тесты

Отредактируйте файл `run_creativity_tests.py` или `run-tests-locally.mjs`:

```python
TESTS = {
    'Ваш тест': {
        'game_settings': {
            'genre': "Жанр",
            'rating': "18+",
            'narrativeMode': "third",  # first / third / love-interest
            'initialCharacters': [
                {
                    'name': "Имя персонажа",
                    'role': "Роль",
                    'description': "Описание",
                    'scenes': "Ключевые сцены (опционально)",
                    'quotes': "Цитаты (опционально)",
                    'ideas': "Мысли/мотивы (опционально)"
                }
            ]
        },
        'setting': "Описание сеттинга и стартовой ситуации",
        'user_action': "",
        'history': []
    }
}
```

### Изменить критерии оценки

Отредактируйте функцию `analyze_response()`:

```python
def analyze_response(test_name, story):
    # Добавьте свои проверки
    if 'ваш_критерий' in story.lower():
        analysis['your_metric'] += 3
        analysis['quotes'].append('✓ Ваш критерий выполнен')
```

## 📁 Файлы проекта

```
├── run_creativity_tests.py          # Python скрипт (основной)
├── run-tests-locally.mjs            # Node.js скрипт
├── creativity-tests-report.html     # HTML отчёт с UI
├── run-creativity-tests.js          # Оригинальный тестовый скрипт
├── backend/
│   └── run-creativity-tests/        # Backend функция
│       ├── index.py
│       ├── requirements.txt
│       └── tests.json
└── CREATIVITY_TESTS_README.md       # Эта документация
```

## 🎓 Интерпретация результатов

### Хороший результат (7-10 баллов)

**Признаки**:
- Персонажи говорят своими голосами
- Мир живой и детализированный
- Эмоции передаются тонко
- Диалоги естественные
- Атмосфера погружает

**Действия**: Можно запускать в продакшн!

### Средний результат (5-6.9 баллов)

**Признаки**:
- Персонажи живые, но иногда шаблонные
- Атмосфера есть, но не всегда
- Встречаются штампы
- Диалоги работают, но не уникальны

**Действия**: Доработать промпт по рекомендациям

### Плохой результат (0-4.9 баллов)

**Признаки**:
- NPC как картонные фигуры
- Штампы в каждом предложении
- Нет атмосферы
- Диалоги шаблонные
- Канон не понят

**Действия**: Переписать промпт с нуля

## 🔍 API Endpoints

### Story Generation API
```
POST https://functions.poehali.dev/9ea67dc2-c306-4906-bf0f-da435600b92c

Body:
{
  "game_settings": {...},
  "setting": "...",
  "user_action": "",
  "history": []
}

Response:
{
  "story": "Сгенерированная история..."
}
```

### Test Runner API (all tests)
```
GET https://functions.poehali.dev/48bae726-ff9a-4027-9dc7-536b2e0f92f1

Response:
{
  "summary": {
    "total_tests": 4,
    "successful": 4,
    "average_score": 7.8,
    "status": "ХОРОШО"
  },
  "results": [...]
}
```

## 📞 Поддержка

Если тесты не запускаются:

1. **Python**: Убедитесь, что установлен `requests`:
   ```bash
   pip install requests
   ```

2. **Node.js**: Используйте версию 18+ (встроенный fetch API)

3. **Ошибки API**: Проверьте, что API доступен:
   ```bash
   curl https://functions.poehali.dev/9ea67dc2-c306-4906-bf0f-da435600b92c
   ```

4. **Timeout**: Нормально для первого запроса (холодный старт)

## 🎯 Заключение

Эти тесты помогут вам:
- ✅ Оценить качество ИИ объективно
- ✅ Найти слабые места промпта
- ✅ Получить конкретные рекомендации
- ✅ Убедиться, что ИИ готов к продакшену

**Рекомендуемая частота тестирования**:
- После каждого изменения промпта
- Раз в неделю для мониторинга
- Перед релизом обязательно

Удачи! 🚀
